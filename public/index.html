<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard di controllo per LinkedIn Bot ‚Äî monitoraggio KPI, risk score, A/B test e gestione incidenti.">
    <title>LinkedIn Bot ‚Äî Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- ‚îÄ‚îÄ MODALE PAUSA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <dialog id="pause-modal" aria-labelledby="pause-modal-title">
        <div class="modal-inner">
            <h2 id="pause-modal-title" class="modal-title">‚è∏ Metti in pausa il bot</h2>
            <label for="pause-minutes-input" class="modal-label">Durata pausa (minuti)</label>
            <input id="pause-minutes-input" class="modal-input" type="number" min="1" max="10080" value="60" placeholder="es. 60">
            <div class="modal-actions">
                <button class="btn btn-warning" id="pause-confirm-btn" onclick="confirmPause()">‚è∏ Conferma Pausa</button>
                <button class="btn btn-secondary" onclick="document.getElementById('pause-modal').close()">‚úï Annulla</button>
            </div>
        </div>
    </dialog>

    <!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <header class="header">
        <div class="header-brand">
            <svg class="brand-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19 0H5C2.24 0 0 2.24 0 5v14c0 2.76 2.24 5 5 5h14c2.76 0 5-2.24 5-5V5c0-2.76-2.24-5-5-5zm-11 19H5V8h3v11zm-1.5-12.27c-.97 0-1.75-.79-1.75-1.75S6.53 3.23 7.5 3.23c.97 0 1.75.79 1.75 1.75s-.78 1.75-1.75 1.75zM20 19h-3v-5.6c0-3.37-4-3.12-4 0V19h-3V8h3v1.77c1.39-2.58 7-2.77 7 2.47V19z"/>
            </svg>
            <span class="brand-name">LinkedIn Bot</span>
            <span class="brand-sub">Dashboard</span>
        </div>
        <div class="header-status">
            <div id="status-badge" class="status-badge status-loading" aria-live="polite">
                <span class="status-dot" aria-hidden="true"></span>
                <span id="status-text">Connessione...</span>
            </div>
            <div class="header-actions">
                <button id="btn-pause" class="btn btn-warning" onclick="openPauseModal()" aria-label="Metti in pausa il bot">‚è∏ Pausa</button>
                <button id="btn-resume" class="btn btn-success" onclick="controlResume()" aria-label="Riprendi il bot">‚ñ∂ Riprendi</button>
            </div>
        </div>
    </header>

    <!-- ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <main class="main">

        <!-- ROW 1: KPI Cards -->
        <section class="kpi-grid" id="kpi-grid" aria-label="KPI principali">
            <div class="kpi-card" id="kpi-invited">
                <div class="kpi-icon" aria-hidden="true">üì®</div>
                <div class="kpi-value" id="val-invited">‚Äî</div>
                <div class="kpi-label">Inviti</div>
            </div>
            <div class="kpi-card" id="kpi-accepted">
                <div class="kpi-icon" aria-hidden="true">ü§ù</div>
                <div class="kpi-value" id="val-accepted">‚Äî</div>
                <div class="kpi-label">Accettati</div>
            </div>
            <div class="kpi-card" id="kpi-messaged">
                <div class="kpi-icon" aria-hidden="true">üí¨</div>
                <div class="kpi-value" id="val-messaged">‚Äî</div>
                <div class="kpi-label">Messaggiati</div>
            </div>
            <div class="kpi-card" id="kpi-replied">
                <div class="kpi-icon" aria-hidden="true">‚úâÔ∏è</div>
                <div class="kpi-value" id="val-replied">‚Äî</div>
                <div class="kpi-label">Risposte</div>
            </div>
            <div class="kpi-card" id="kpi-risk">
                <div class="kpi-icon" aria-hidden="true">üõ°Ô∏è</div>
                <div class="kpi-value" id="val-risk">‚Äî</div>
                <div class="kpi-label">Risk Score</div>
            </div>
            <div class="kpi-card" id="kpi-total">
                <div class="kpi-icon" aria-hidden="true">üéØ</div>
                <div class="kpi-value" id="val-total">‚Äî</div>
                <div class="kpi-label">Lead Totali</div>
            </div>
        </section>

        <!-- ROW 2: Funnel Chart + Conversion Rates -->
        <section class="charts-row">
            <div class="card chart-card chart-large">
                <div class="card-header">
                    <h2 class="card-title">üìä Funnel Lead</h2>
                    <span class="card-subtitle" id="funnel-updated">‚Äî</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="funnelChart" aria-label="Grafico funnel lead"></canvas>
                </div>
            </div>
            <div class="card chart-card chart-small">
                <div class="card-header">
                    <h2 class="card-title">‚ö° Conversion Rates</h2>
                </div>
                <div class="conversion-stats" id="conversion-stats">
                    <div class="conv-item">
                        <span class="conv-label">Accept Rate</span>
                        <span class="conv-value" id="conv-accept">‚Äî</span>
                    </div>
                    <div class="conv-item">
                        <span class="conv-label">Reply Rate</span>
                        <span class="conv-value" id="conv-reply">‚Äî</span>
                    </div>
                    <div class="conv-item">
                        <span class="conv-label">Msg ‚Üí Reply</span>
                        <span class="conv-value" id="conv-msg-reply">‚Äî</span>
                    </div>
                    <div class="conv-divider"></div>
                    <div class="conv-item">
                        <span class="conv-label">Sistema</span>
                        <span id="system-state" class="conv-value system-ok">OK</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ROW 3: Trend 7gg + Incidents -->
        <section class="charts-row">
            <div class="card chart-card">
                <div class="card-header">
                    <h2 class="card-title">üìà Attivit√† ultimi 7 giorni</h2>
                    <span class="card-subtitle">Inviti ¬∑ Messaggi ¬∑ Accettazioni</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="trendChart" aria-label="Grafico trend 7 giorni"></canvas>
                </div>
            </div>
            <div class="card chart-card">
                <div class="card-header">
                    <h2 class="card-title">üö® Incidenti Aperti</h2>
                    <span class="card-subtitle" id="incidents-count">‚Äî</span>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="incidents-table" aria-label="Incidenti aperti">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo</th>
                                <th>Severity</th>
                                <th>Aperto</th>
                                <th>Azione</th>
                            </tr>
                        </thead>
                        <tbody id="incidents-tbody">
                            <tr><td colspan="5" class="empty-state">Caricamento...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ROW 4: A/B Leaderboard + Timing Heatmap -->
        <section class="charts-row">
            <div class="card chart-card chart-medium">
                <div class="card-header">
                    <h2 class="card-title">üß™ A/B Varianti Note</h2>
                    <span class="card-subtitle">Bandit Score</span>
                </div>
                <div class="table-wrapper">
                    <table class="data-table" id="ab-table" aria-label="A/B test varianti">
                        <thead>
                            <tr>
                                <th>Variante</th>
                                <th>Inviati</th>
                                <th>Acc%</th>
                                <th>Reply%</th>
                                <th>UCB</th>
                            </tr>
                        </thead>
                        <tbody id="ab-tbody">
                            <tr><td colspan="5" class="empty-state">Caricamento...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card chart-card chart-medium">
                <div class="card-header">
                    <h2 class="card-title">‚è∞ Best Time Slots</h2>
                    <span class="card-subtitle">Orari ad alto engagement</span>
                </div>
                <div class="timing-list" id="timing-list">
                    <div class="empty-state">Caricamento...</div>
                </div>
            </div>
        </section>

        <!-- ROW 5: Recent Runs -->
        <section class="card full-width-card">
            <div class="card-header">
                <h2 class="card-title">ü§ñ Campaign Runs Recenti</h2>
                <button class="btn btn-sm btn-secondary" onclick="loadData()" aria-label="Aggiorna dati">‚Üª Aggiorna</button>
            </div>
            <div class="table-wrapper">
                <table class="data-table" id="runs-table" aria-label="Campaign runs recenti">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Inizio</th>
                            <th>Fine</th>
                            <th>Status</th>
                            <th>Profili Scoperti</th>
                            <th>Errore</th>
                        </tr>
                    </thead>
                    <tbody id="runs-tbody">
                        <tr><td colspan="6" class="empty-state">Caricamento...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <footer class="footer">
        <span id="last-refresh">Ultimo aggiornamento: ‚Äî</span>
        <span>LinkedIn Bot Dashboard</span>
    </footer>

    <script src="/app.js"></script>
</body>
</html>
